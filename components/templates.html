    <template id="tpl-lookup-result">
        {{#success}}
        <div class="animate-fade-in-down">
            <div class="bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg mb-6 flex items-center">
                <i class="fa-solid fa-check-circle mr-2 text-xl"></i>
                <div>
                    <p class="font-bold text-sm">ƒê√£ t√¨m th·∫•y d·ªØ li·ªáu</p>
                    <p class="text-xs">{{data.name}}</p>
                </div>
            </div>
            
            <input type="hidden" name="customer_name" value="{{data.name}}">
            <input type="hidden" name="contract_code" id="lookup-contract-code" value="">
            <input type="hidden" name="phone" value="{{data.phone}}">
            <input type="hidden" name="cccd" value="{{data.cccd}}">
            <input type="hidden" name="address" value="{{data.address}}">
            <input type="hidden" name="email" value="{{data.email}}">
            <input type="hidden" name="car_model" value="{{data.carModel}}">
            <input type="hidden" name="car_version" value="{{data.carVersion}}">
            <input type="hidden" name="car_color" value="{{data.carColor}}">
            <input type="hidden" name="vin_no" value="">
            <input type="hidden" name="payment_method" value="{{data.payment}}">

            <div class="grid grid-cols-2 gap-4 mb-4 text-sm bg-gray-50 p-4 rounded border">
                <div><span class="text-xs text-gray-500 block">KH√ÅCH H√ÄNG</span><span class="font-bold">{{data.name}}</span></div>
                <div><span class="text-xs text-gray-500 block">D√íNG XE</span><span class="font-bold text-blue-800">{{data.carModel}} {{data.carVersion}}</span></div>
                <div><span class="text-xs text-gray-500 block">SƒêT</span><span>{{data.phone}}</span></div>
                <div><span class="text-xs text-gray-500 block">ƒê·ªäA CH·ªà</span><span>{{data.address}}</span></div>
                <div><span class="text-xs text-gray-500 block">THANH TO√ÅN</span><span>{{data.payment}}</span></div>
                <div><span class="text-xs text-gray-500 block">M√ÄU XE</span><span>{{data.carColor}}</span></div>
            </div>

            <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200 space-y-4">
                <div>
                    <label class="block text-sm font-bold text-gray-800 mb-1">Gi√° tr·ªã H·ª£p ƒë·ªìng (VNƒê) *</label>
                    <input name="contract_price" type="text" class="w-full border-2 border-yellow-400 p-2 rounded text-lg font-bold text-gray-800 outline-none" oninput="formatMoneyInput(this)" required placeholder="0">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><label class="label">Chi ti·∫øt gi·∫£m gi√°</label><textarea name="discount_details" rows="1" class="input"></textarea></div>
                    <div><label class="label">Ti·ªÅn gi·∫£m (VNƒê)</label><input name="discount_amount" oninput="formatMoneyInput(this)" class="input" placeholder="0"></div>
                </div>
                
                <div class="border-t border-yellow-200 pt-2">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-sm font-bold">Qu√† t·∫∑ng</label>
                        <button type="button" onclick="addGiftRow('gift-list-search')" class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded font-bold hover:bg-blue-200">+ Th√™m</button>
                    </div>
                    <div id="gift-list-search" class="space-y-2"></div>
                    <input type="hidden" name="gift_json" id="hidden_gift_json_search">
                    <div class="flex justify-end mt-2 text-sm"><span class="font-bold text-gray-600 mr-2">T·ªïng qu√†:</span><span id="total-gift-search" class="font-bold text-blue-600">0</span></div>
                </div>
            </div>

            <script> 
                (function() {
                    const actionArea = document.getElementById('action-area');
                    if (actionArea) actionArea.classList.remove('hidden');
                    if (typeof addGiftRow === 'function') {
                        addGiftRow('gift-list-search');
                    }
                })();
            </script>
        </div>
        {{/success}}
        {{^success}}
        <div class="bg-red-50 text-red-700 p-4 rounded text-center font-bold animate-bounce-short">‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng n√†y!</div>
        {{/success}}
    </template>

    <template id="tpl-pending-list">
        {{#data}}
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-3 mb-3 cursor-pointer hover:shadow-lg hover:border-blue-300 transition-all relative overflow-hidden group" onclick="openDetail('{{json_string}}')">
            {{#can_resubmit}}
            <div class="absolute left-0 top-0 bottom-0 w-1 bg-red-500"></div>
            {{/can_resubmit}}
            {{^can_resubmit}}
            <div class="absolute left-0 top-0 bottom-0 w-1 bg-blue-500"></div>
            {{/can_resubmit}}
            <div class="flex justify-between items-start pl-3">
                <div class="flex-1">
                    <div class="flex items-center gap-2 mb-1">
                    <span class="bg-blue-100 text-blue-800 text-[10px] font-bold px-2 py-1 rounded uppercase">{{contract_code}}</span>
                        {{#can_resubmit}}
                        <span class="text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded font-semibold">
                            <i class="fa-solid fa-exclamation-triangle mr-1"></i>ƒê√£ b·ªã t·ª´ ch·ªëi - C·∫ßn s·ª≠a
                        </span>
                        {{/can_resubmit}}
                    </div>
                    <p class="text-xs text-gray-500 mb-1">Ng∆∞·ªùi tr√¨nh: <span class="font-medium text-gray-700">{{requester_fullname}}</span> ¬∑ T·∫°o: <span class="text-gray-600">{{created_at_display}}</span></p>
                    <h3 class="font-bold text-gray-800 text-lg mb-1">{{customer}}</h3>
                    <div class="flex flex-wrap items-center gap-2 text-xs text-gray-500">
                        {{#phone}}<span><i class="fa-solid fa-phone mr-1"></i>{{phone}}</span>{{/phone}}
                        {{#email}}<span><i class="fa-solid fa-envelope mr-1"></i>{{email}}</span>{{/email}}
                </div>
            </div>
                <div class="text-right ml-4">
                    <span class="text-xs text-gray-400 block mb-2">{{date}}</span>
                    {{#can_resubmit}}
                    <span class="text-xs font-bold bg-red-100 text-red-700 px-2 py-1 rounded block">{{status_text}}</span>
                    {{/can_resubmit}}
                    {{^can_resubmit}}
                    <span class="text-xs font-bold bg-blue-50 text-blue-700 px-2 py-1 rounded block border border-blue-200">{{status_text}}</span>
                    {{/can_resubmit}}
                </div>
            </div>
            <div class="pl-3 mt-3 pt-3 border-t border-gray-100">
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-2 text-sm text-gray-700">
                        <i class="fa-solid fa-car-side text-blue-600"></i>
                        <span class="font-semibold">{{car_model}}</span>
                        {{#car_version}}<span class="text-gray-500">- {{car_version}}</span>{{/car_version}}
                        {{#car_color}}<span class="text-xs bg-gray-100 px-2 py-0.5 rounded text-gray-600">{{car_color}}</span>{{/car_color}}
                    </div>
                </div>
                {{#payment}}
                <div class="text-xs text-gray-500 mb-2">
                    <i class="fa-solid fa-credit-card mr-1"></i>Thanh to√°n: {{payment}}
                </div>
                {{/payment}}
                <div class="flex justify-between items-center pt-2 border-t border-gray-100">
                    <span class="text-xs text-gray-500">Gi√° ch·ªët:</span>
                    <span class="text-blue-600 font-bold text-lg">{{final_price}}</span>
                </div>
            </div>
            <div class="pl-3 mt-3 text-xs text-center text-blue-500 group-hover:text-blue-700 font-semibold">
                <i class="fa-solid fa-arrow-right mr-1"></i>Nh·∫•n ƒë·ªÉ xem chi ti·∫øt
            </div>
        </div>
        {{/data}}
        {{^data}}
        <div class="text-center text-gray-400 py-12 bg-white rounded-lg border border-gray-200">
            <i class="fa-regular fa-folder-open text-5xl mb-3 opacity-30"></i>
            <p class="text-lg font-semibold">Kh√¥ng c√≥ ƒë∆°n h√†ng n√†o</p>
            <p class="text-sm mt-1">Vui l√≤ng th·ª≠ l·∫°i sau ho·∫∑c ki·ªÉm tra b·ªô l·ªçc</p>
        </div>
        {{/data}}
    </template>

    <template id="tpl-my-requests-list">
        {{#data}}
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-3 hover:shadow-md transition relative overflow-hidden">
            {{#can_resubmit}}
            <div class="absolute left-0 top-0 bottom-0 w-1 bg-red-500"></div>
            {{/can_resubmit}}
            {{^can_resubmit}}
            <div class="absolute left-0 top-0 bottom-0 w-1 bg-blue-500"></div>
            {{/can_resubmit}}
            <div class="flex justify-between items-start pl-3">
                <div class="flex-1">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="bg-blue-100 text-blue-800 text-[10px] font-bold px-2 py-1 rounded uppercase">{{contract_code}}</span>
                        {{#can_resubmit}}
                        <span class="text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded font-semibold">
                            <i class="fa-solid fa-exclamation-triangle mr-1"></i>ƒê√£ b·ªã t·ª´ ch·ªëi - C·∫ßn s·ª≠a
                        </span>
                        {{/can_resubmit}}
                        {{#is_completed}}
                        <span class="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded font-semibold">
                            <i class="fa-solid fa-check-circle mr-1"></i>Ho√†n t·∫•t
                        </span>
                        {{/is_completed}}
                    </div>
                    <h3 class="font-bold text-gray-800 text-lg mb-1">{{customer}}</h3>
                    <div class="flex flex-wrap items-center gap-2 text-xs text-gray-500">
                        {{#phone}}<span><i class="fa-solid fa-phone mr-1"></i>{{phone}}</span>{{/phone}}
                        {{#email}}<span><i class="fa-solid fa-envelope mr-1"></i>{{email}}</span>{{/email}}
                    </div>
                </div>
                <div class="text-right ml-4">
                    <span class="text-xs text-gray-400 block mb-2">{{date}}</span>
                    <span class="text-xs font-bold bg-gray-100 px-2 py-1 rounded block text-gray-600">{{status_text}}</span>
                    {{#next_status}}
                    <span class="text-xs text-gray-500 mt-1 block">‚Üí {{next_status}}</span>
                    {{/next_status}}
                </div>
            </div>
            <div class="pl-3 mt-3 pt-3 border-t border-gray-100">
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-2 text-sm text-gray-700">
                        <i class="fa-solid fa-car-side text-blue-600"></i>
                        <span class="font-semibold">{{car_model}}</span>
                        {{#car_version}}<span class="text-gray-500">- {{car_version}}</span>{{/car_version}}
                        {{#car_color}}<span class="text-xs bg-gray-100 px-2 py-0.5 rounded text-gray-600">{{car_color}}</span>{{/car_color}}
                    </div>
                </div>
                <div class="flex justify-between items-center pt-2 border-t border-gray-100">
                    <span class="text-xs text-gray-500">Gi√° ch·ªët:</span>
                    <span class="text-blue-600 font-bold text-lg">{{final_price}}</span>
                </div>
            </div>
            <div class="pl-3 mt-3 flex gap-2">
                {{#can_resubmit}}
                <button onclick="openEditRequest('{{id}}')" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white py-2 rounded-lg font-semibold text-sm transition">
                    <i class="fa-solid fa-edit mr-1"></i>S·ª≠a l·∫°i
                </button>
                {{/can_resubmit}}
                <button onclick="openDetail('{{json_string}}')" class="flex-1 bg-blue-50 hover:bg-blue-100 text-blue-700 py-2 rounded-lg font-semibold text-sm transition border border-blue-200">
                    <i class="fa-solid fa-eye mr-1"></i>Xem chi ti·∫øt
                </button>
                {{#is_completed}}
                {{#can_print}}
                <button onclick="printRequest('{{id}}')" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg font-semibold text-sm transition">
                    <i class="fa-solid fa-print mr-1"></i>In t·ªù tr√¨nh
                </button>
                {{/can_print}}
                {{/is_completed}}
            </div>
        </div>
        {{/data}}
        {{^data}}
        <div class="text-center text-gray-400 py-12 bg-white rounded-lg border border-gray-200">
            <i class="fa-regular fa-folder-open text-5xl mb-3 opacity-30"></i>
            <p class="text-lg font-semibold">Ch∆∞a c√≥ t·ªù tr√¨nh n√†o</p>
            <p class="text-sm mt-1">T·∫°o t·ªù tr√¨nh m·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu</p>
        </div>
        {{/data}}
    </template>

    <template id="tpl-order-detail">
        <div class="relative">
            <div class="bg-blue-600 text-white p-4 flex justify-between items-center sticky top-0 z-10">
                <div>
                    <h3 class="font-bold text-lg">CHI TI·∫æT T·ªú TR√åNH</h3>
                    <p class="text-xs opacity-80">M√£ Hƒê: 
                        {{#can_edit_completed}}
                        <input type="text" id="detail-contract-code" value="{{contract_code}}" class="bg-white text-gray-800 px-2 py-1 rounded text-xs w-32" placeholder="Nh·∫≠p s·ªë Hƒê">
                        {{/can_edit_completed}}
                        {{^can_edit_completed}}
                        {{contract_code}}
                        {{/can_edit_completed}}
                    </p>
                </div>
                <button onclick="closeModal()" class="text-2xl hover:text-red-200">&times;</button>
            </div>
            
            <div class="p-6 space-y-6">
                <!-- Th√¥ng tin kh√°ch h√†ng -->
                <div class="bg-white border border-gray-200 rounded-lg p-4">
                    <h4 class="font-bold text-sm text-gray-600 uppercase mb-3 flex items-center gap-2">
                        <i class="fa-solid fa-user text-blue-600"></i>Th√¥ng tin kh√°ch h√†ng
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                    <div>
                            <p class="text-gray-500 text-xs mb-1">H·ªç v√† t√™n</p>
                            <p class="font-bold text-gray-800">{{customer}}</p>
                        </div>
                        <div>
                            <p class="text-gray-500 text-xs mb-1">S·ªë ƒëi·ªán tho·∫°i</p>
                            <p class="font-semibold text-gray-700"><i class="fa-solid fa-phone mr-1 text-blue-600"></i>{{phone}}</p>
                        </div>
                        {{#cccd}}
                        <div>
                            <p class="text-gray-500 text-xs mb-1">CCCD/CMND</p>
                            <p class="font-semibold text-gray-700">{{cccd}}</p>
                        </div>
                        {{/cccd}}
                        {{#email}}
                        <div>
                            <p class="text-gray-500 text-xs mb-1">Email</p>
                            <p class="font-semibold text-gray-700"><i class="fa-solid fa-envelope mr-1 text-blue-600"></i>{{email}}</p>
                        </div>
                        {{/email}}
                        {{#address}}
                        <div class="md:col-span-2">
                            <p class="text-gray-500 text-xs mb-1">ƒê·ªãa ch·ªâ</p>
                            <p class="font-semibold text-gray-700"><i class="fa-solid fa-map-marker-alt mr-1 text-blue-600"></i>{{address}}</p>
                        </div>
                        {{/address}}
                    </div>
                    <div class="mt-3 pt-3 border-t border-gray-100 flex justify-between items-center">
                        <div>
                            <p class="text-xs text-gray-500">Ng∆∞·ªùi t·∫°o</p>
                            <p class="text-sm font-semibold text-blue-700">
                                {{#requester_fullname}}{{requester_fullname}}{{/requester_fullname}}{{^requester_fullname}}{{requester}}{{/requester_fullname}}
                            </p>
                    </div>
                    <div class="text-right">
                            <p class="text-xs text-gray-500">Ng√†y t·∫°o</p>
                            <p class="text-sm font-semibold text-gray-700">{{#created_at_display}}{{created_at_display}}{{/created_at_display}}{{^created_at_display}}{{date}}{{/created_at_display}}</p>
                        </div>
                    </div>
                </div>

                <!-- Th√¥ng tin xe -->
                <div class="bg-gradient-to-r from-gray-50 to-blue-50 p-4 rounded-lg border border-gray-200">
                    <h4 class="font-bold text-sm text-gray-600 uppercase mb-3 flex items-center gap-2">
                        <i class="fa-solid fa-car text-blue-600"></i>Th√¥ng tin xe
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                        <div>
                            <p class="text-gray-500 text-xs mb-1">D√≤ng xe</p>
                            <p class="font-bold text-lg text-gray-800">
                                üöô {{car_model}}{{#car_version}} <span class="text-base">{{car_version}}</span>{{/car_version}}
                            </p>
                    </div>
                        {{#car_color}}
                        <div>
                            <p class="text-gray-500 text-xs mb-1">M√†u s·∫Øc</p>
                            <p class="font-bold text-gray-700">{{car_color}}</p>
                        </div>
                        {{/car_color}}
                        <div>
                            <p class="text-gray-500 text-xs mb-1">S·ªë VIN</p>
                            {{#can_edit_completed}}
                            <input type="text" id="detail-vin-no" value="{{vin_no}}" class="font-mono text-xs text-gray-700 bg-white px-2 py-1 rounded border w-full" placeholder="Nh·∫≠p s·ªë khung">
                            {{/can_edit_completed}}
                            {{^can_edit_completed}}
                            {{#vin_no}}
                            <p class="font-mono text-xs text-gray-700 bg-white px-2 py-1 rounded border">{{vin_no}}</p>
                            {{/vin_no}}
                            {{^vin_no}}
                            <p class="text-gray-400 italic text-xs">Ch∆∞a c√≥</p>
                            {{/vin_no}}
                            {{/can_edit_completed}}
                        </div>
                        {{#manufacture_year}}
                        <div>
                            <p class="text-gray-500 text-xs mb-1">NƒÉm s·∫£n xu·∫•t</p>
                            <p class="font-bold text-gray-700">{{manufacture_year}}</p>
                        </div>
                        {{/manufacture_year}}
                        {{#seats}}
                        <div>
                            <p class="text-gray-500 text-xs mb-1">S·ªë ch·ªó ng·ªìi</p>
                            <p class="font-bold text-gray-700">{{seats}}</p>
                        </div>
                        {{/seats}}
                        {{#payment}}
                        <div>
                            <p class="text-gray-500 text-xs mb-1">Ph∆∞∆°ng th·ª©c thanh to√°n</p>
                            <p class="font-semibold text-gray-700">{{payment}}</p>
                        </div>
                        {{/payment}}
                    </div>
                </div>

                <!-- B·∫£ng gi√° -->
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                    <div class="bg-blue-600 text-white p-3 font-bold text-center">
                        <i class="fa-solid fa-calculator mr-2"></i>B·∫¢NG GI√Å
                    </div>
                    <div class="divide-y divide-gray-200">
                        <div class="flex justify-between items-center p-4 hover:bg-gray-50 transition">
                            <div class="flex items-center gap-2">
                                <i class="fa-solid fa-file-contract text-blue-600"></i>
                                <span class="text-gray-700">Gi√° h·ª£p ƒë·ªìng</span>
                            </div>
                            <span class="font-bold text-lg text-gray-800">{{contract_price}}</span>
                        </div>
                        <div class="p-4 bg-red-50 border-l-4 border-red-400">
                            <div class="flex justify-between items-center mb-2">
                                <div class="flex items-center gap-2">
                                    <i class="fa-solid fa-tag text-red-600"></i>
                                    <span class="text-red-700 font-semibold">(-) Gi·∫£m gi√°</span>
                                </div>
                                <span class="font-bold text-lg text-red-700">{{discount_amount}}</span>
                            </div>
                            {{#discount_details}}
                            <div class="mt-2 p-2 bg-white rounded border border-red-200 text-xs text-gray-700">
                                <i class="fa-solid fa-info-circle mr-1 text-red-600"></i>
                                <span class="font-medium">L√Ω do gi·∫£m gi√°:</span>
                                <p class="mt-1 italic pl-4">{{discount_details}}</p>
                            </div>
                            {{/discount_details}}
                        </div>
                        <div class="p-4 bg-yellow-50">
                            <div class="flex items-start gap-2 mb-2">
                                <i class="fa-solid fa-gift text-yellow-600 mt-1"></i>
                                <div class="flex-1">
                                    <p class="font-semibold text-gray-700 mb-1">üéÅ Qu√† t·∫∑ng</p>
                                    <div class="bg-white rounded p-2 text-xs text-gray-600 whitespace-pre-line border border-yellow-200">
                                        {{#gift_details}}{{gift_details}}{{/gift_details}}{{^gift_details}}Kh√¥ng c√≥ qu√† t·∫∑ng{{/gift_details}}
                                    </div>
                                </div>
                            </div>
                            <div class="flex justify-between items-center mt-3 pt-3 border-t border-yellow-200">
                                <span class="text-xs font-semibold text-gray-600">T·ªïng gi√° tr·ªã qu√† t·∫∑ng:</span>
                                <span class="font-bold text-gray-800">{{gift_amount}}</span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center p-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white">
                            <span class="font-bold text-lg flex items-center gap-2">
                                <i class="fa-solid fa-check-circle"></i>
                                GI√Å CH·ªêT CU·ªêI C√ôNG
                            </span>
                            <span class="font-bold text-2xl">{{final_price}}</span>
                        </div>
                    </div>
                </div>

                <!-- Y√™u c·∫ßu kh√°c -->
                {{#other_requirements}}
                <div class="bg-white border border-gray-200 rounded-lg p-4">
                    <h4 class="font-bold text-sm text-gray-600 uppercase mb-3 flex items-center gap-2">
                        <i class="fa-solid fa-clipboard-list text-blue-600"></i>Y√™u c·∫ßu kh√°c
                    </h4>
                    <div class="bg-gray-50 p-3 rounded border border-gray-200 text-sm text-gray-700 whitespace-pre-line">
                        {{other_requirements}}
                    </div>
                </div>
                {{/other_requirements}}

                <!-- L∆∞∆°ng nƒÉng su·∫•t -->
                <div class="bg-white border border-gray-200 rounded-lg p-4">
                    <h4 class="font-bold text-sm text-gray-600 uppercase mb-3 flex items-center gap-2">
                        <i class="fa-solid fa-money-bill-wave text-blue-600"></i>L∆∞∆°ng nƒÉng su·∫•t
                    </h4>
                    <div class="space-y-3">
                <div>
                            <p class="text-xs text-gray-500 mb-1">L∆∞∆°ng nƒÉng su·∫•t (VNƒê)</p>
                            <div class="flex gap-2 items-center">
                                {{#can_edit_cost}}
                                <input type="text" id="detail-productivity-bonus" value="{{productivity_bonus}}" 
                                       class="flex-1 border p-2 rounded text-sm" 
                                       placeholder="Nh·∫≠p s·ªë ti·ªÅn" 
                                       oninput="formatMoneyInput(this)">
                                <button onclick="saveProductivityBonus('{{id}}')" 
                                        class="bg-blue-600 text-white px-3 py-2 rounded text-sm hover:bg-blue-700 transition">
                                    <i class="fa-solid fa-save"></i>
                                </button>
                                {{/can_edit_cost}}
                                {{^can_edit_cost}}
                                <p class="font-semibold text-gray-800 flex-1">{{#productivity_bonus}}{{productivity_bonus}}{{/productivity_bonus}}{{^productivity_bonus}}Ch∆∞a nh·∫≠p{{/productivity_bonus}}</p>
                                {{/can_edit_cost}}
                            </div>
                            <p class="text-xs text-gray-500 mt-1 italic">{{#can_edit_cost}}C√≥ th·ªÉ ƒëi·ªÅu ch·ªânh l∆∞∆°ng nƒÉng su·∫•t khi duy·ªát{{/can_edit_cost}}{{^can_edit_cost}}TVBH ƒë·ªÅ xu·∫•t: {{productivity_bonus}}{{/can_edit_cost}}</p>
                        </div>
                        <div class="bg-gray-50 p-3 rounded border border-gray-200">
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-gray-600">Chi ph√≠ b√°n h√†ng:</span>
                                <span class="font-semibold text-gray-800">{{total_cost}}</span>
                            </div>
                            <div class="flex justify-between items-center text-sm mt-2">
                                <span class="text-gray-600">T·ª∑ l·ªá (%):</span>
                                <span class="font-semibold text-gray-800">{{cost_percentage}}%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tr·∫°ng th√°i hi·ªán t·∫°i -->
                <div class="bg-white border border-gray-200 rounded-lg p-4">
                    <h4 class="font-bold text-sm text-gray-600 uppercase mb-3 flex items-center gap-2">
                        <i class="fa-solid fa-info-circle text-blue-600"></i>Tr·∫°ng th√°i ph√™ duy·ªát
                    </h4>
                    <div class="space-y-3">
                <div>
                            <p class="text-xs text-gray-500 mb-1">Tr·∫°ng th√°i hi·ªán t·∫°i:</p>
                            <span class="px-4 py-2 rounded-lg font-bold text-sm inline-block {{#can_resubmit}}bg-red-100 text-red-800{{/can_resubmit}}{{^can_resubmit}}{{#is_completed}}bg-green-100 text-green-800{{/is_completed}}{{^is_completed}}bg-blue-100 text-blue-800{{/is_completed}}{{/can_resubmit}}">
                                {{#can_resubmit}}
                                <i class="fa-solid fa-exclamation-triangle mr-1"></i>ƒê√£ b·ªã t·ª´ ch·ªëi - C·∫ßn s·ª≠a
                                {{/can_resubmit}}
                                {{^can_resubmit}}
                                {{#is_completed}}
                                <i class="fa-solid fa-check-circle mr-1"></i>Ho√†n t·∫•t ph√™ duy·ªát
                                {{/is_completed}}
                                {{^is_completed}}
                                {{status_text}}
                                {{/is_completed}}
                                {{/can_resubmit}}
                            </span>
                </div>
                        {{#next_status}}
                        <div>
                            <p class="text-xs text-gray-500 mb-1">B∆∞·ªõc duy·ªát ti·∫øp theo:</p>
                            <span class="px-4 py-2 rounded-lg font-semibold text-sm inline-block bg-gray-100 text-gray-700 border border-gray-300">
                                <i class="fa-solid fa-arrow-right mr-1 text-blue-600"></i>{{next_status}}
                            </span>
                        </div>
                        {{/next_status}}
                    </div>
                </div>

                <!-- L·ªãch s·ª≠ ph√™ duy·ªát -->
                <div class="bg-gradient-to-br from-white to-gray-50 border border-gray-200 rounded-lg p-5 shadow-sm">
                    <h4 class="font-bold text-base text-gray-700 uppercase mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-history text-blue-600 text-lg"></i>
                        <span>L·ªãch s·ª≠ ph√™ duy·ªát</span>
                    </h4>
                    <div class="space-y-3 max-h-80 overflow-y-auto pr-2">
                        {{#log_entries}}
                        {{#.}}
                        <div class="relative border-l-4 pl-4 pb-4 pt-2 rounded-r-lg transition-all hover:shadow-md {{#is_approve}}border-green-500 bg-gradient-to-r from-green-50 to-green-50/50{{/is_approve}}{{#is_reject}}border-red-500 bg-gradient-to-r from-red-50 to-red-50/50{{/is_reject}}{{^is_approve}}{{^is_reject}}border-blue-400 bg-gradient-to-r from-blue-50 to-blue-50/50{{/is_reject}}{{/is_approve}}">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex items-center gap-2">
                                    {{#is_approve}}
                                    <i class="fa-solid fa-check-circle text-green-600 text-lg"></i>
                                    {{/is_approve}}
                                    {{#is_reject}}
                                    <i class="fa-solid fa-times-circle text-red-600 text-lg"></i>
                                    {{/is_reject}}
                                    {{^is_approve}}{{^is_reject}}
                                    <i class="fa-solid fa-clock text-blue-500 text-lg"></i>
                                    {{/is_reject}}{{/is_approve}}
                                    <span class="font-bold text-sm text-gray-700">{{time}}</span>
                                </div>
                                {{#user}}
                                <span class="text-xs font-medium text-gray-600 bg-white/80 backdrop-blur-sm px-3 py-1.5 rounded-full border border-gray-200 shadow-sm">
                                    <i class="fa-solid fa-user mr-1.5 text-blue-500"></i>
                                    <span class="font-semibold">{{user}}</span>{{#role}} <span class="text-gray-500 font-normal">({{role}})</span>{{/role}}
                                </span>
                                {{/user}}
                            </div>
                            <div class="mt-2">
                                <span class="inline-flex items-center gap-2 font-semibold text-sm px-3 py-1.5 rounded-lg {{#is_approve}}text-green-800 bg-green-100{{/is_approve}}{{#is_reject}}text-red-800 bg-red-100{{/is_reject}}{{^is_approve}}{{^is_reject}}text-blue-800 bg-blue-100{{/is_reject}}{{/is_approve}}">
                                    {{action}}
                                </span>
                                {{#comment}}
                                <div class="mt-3 p-3 bg-white/90 backdrop-blur-sm rounded-lg border-l-4 border-blue-400 shadow-sm">
                                    <div class="flex items-start gap-2">
                                        <i class="fa-solid fa-comment-dots mt-0.5 text-blue-600"></i>
                                        <div class="flex-1">
                                            <span class="text-xs font-medium text-gray-500 block mb-1">L√Ω do:</span>
                                            <span class="text-sm text-gray-700 leading-relaxed italic">{{comment}}</span>
                                        </div>
                                    </div>
                                </div>
                                {{/comment}}
                            </div>
                        </div>
                        {{/.}}
                        {{/log_entries}}
                        {{^log_entries}}
                        {{#logs}}
                        <div class="bg-gradient-to-r from-gray-50 to-gray-50/50 p-4 rounded-lg border-l-4 border-gray-400 shadow-sm">
                            <div class="whitespace-pre-line text-gray-700 font-mono text-xs leading-relaxed">{{logs}}</div>
                        </div>
                        {{/logs}}
                        {{^logs}}
                        <div class="text-center py-8 text-gray-400">
                            <i class="fa-solid fa-inbox text-4xl mb-3 block opacity-50"></i>
                            <p class="text-sm font-medium italic">Ch∆∞a c√≥ l·ªãch s·ª≠ ph√™ duy·ªát</p>
                        </div>
                        {{/logs}}
                        {{/log_entries}}
                    </div>
                </div>

                <!-- N√∫t h√†nh ƒë·ªông -->
                <div class="bg-gray-50 border-t border-gray-200 -mx-6 -mb-6 p-4 rounded-b-lg">
                    {{#can_resubmit}}
                    <button onclick="resubmitRequest('{{id}}')" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white py-3 rounded-lg font-bold shadow-lg transition transform active:scale-95 flex items-center justify-center gap-2">
                        <i class="fa-solid fa-paper-plane"></i>
                        <span>G·ª≠i l·∫°i ƒë·ªÉ duy·ªát</span>
                    </button>
                    {{/can_resubmit}}
                    {{^can_resubmit}}
                    {{#is_completed}}
                    <div class="space-y-2">
                        {{#can_edit_completed}}
                        <button onclick="saveCompletedRequestInfo('{{id}}')" class="w-full bg-gradient-to-r from-yellow-600 to-yellow-700 hover:from-yellow-700 hover:to-yellow-800 text-white py-2 rounded-lg font-bold shadow-lg transition transform active:scale-95 flex items-center justify-center gap-2">
                            <i class="fa-solid fa-save"></i>
                            <span>L∆∞u thay ƒë·ªïi s·ªë Hƒê & s·ªë khung</span>
                        </button>
                        {{/can_edit_completed}}
                        {{#can_print}}
                        <button onclick="printRequest('{{id}}')" class="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white py-3 rounded-lg font-bold shadow-lg transition transform active:scale-95 flex items-center justify-center gap-2">
                            <i class="fa-solid fa-print"></i>
                            <span>In t·ªù tr√¨nh</span>
                        </button>
                        {{/can_print}}
                    </div>
                    {{/is_completed}}
                    {{^is_completed}}
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="confirmAction('{{id}}', 'approve')" class="bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white py-3 rounded-lg font-bold shadow-lg transition transform active:scale-95 flex items-center justify-center gap-2">
                            <i class="fa-solid fa-check-circle"></i>
                            <span>Duy·ªát</span>
                        </button>
                        <button onclick="confirmAction('{{id}}', 'reject')" class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white py-3 rounded-lg font-bold shadow-lg transition transform active:scale-95 flex items-center justify-center gap-2">
                            <i class="fa-solid fa-times-circle"></i>
                            <span>T·ª´ ch·ªëi</span>
                        </button>
                    </div>
                    {{/is_completed}}
                    {{/can_resubmit}}
                </div>
            </div>
        </div>
    </template>

