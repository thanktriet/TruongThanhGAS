<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VinFast Tr∆∞∆°ng Th√†nh Smart Inventory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Plus+Jakarta+Sans:wght@700;800&display=swap');
        
        :root {
            --vf-blue: #003087; /* VinFast Blue */
            --vf-gray: #f8fafc;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--vf-gray);
            color: #1e293b;
            letter-spacing: -0.01em;
        }

        h1, h2, h3, .font-heading { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
        }

        /* Hi·ªáu ·ª©ng k√≠nh m·ªù cho Header */
        .glass-header {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
        }

        /* Bo g√≥c m∆∞·ª£t m√† ki·ªÉu iOS/Modern Web */
        .card-premium {
            background: #ffffff;
            border-radius: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.02), 0 2px 4px -2px rgba(0, 0, 0, 0.02);
            border: 1px solid #f1f5f9;
        }

        /* Badge tr·∫°ng th√°i r√µ r√†ng h∆°n */
        .badge {
            padding: 6px 12px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        /* T·ªëi ∆∞u h√≥a b·∫£ng */
        .v-table th {
            font-size: 11px;
            font-weight: 800;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 16px;
        }

        .v-table td {
            padding: 16px;
            vertical-align: middle;
        }

        /* TƒÉng k√≠ch th∆∞·ªõc v√πng b·∫•m cho n√∫t */
        .btn-action {
            width: 36px;
            height: 36px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            transition: all 0.2s;
        }

        /* Input ƒë·∫πp h∆°n */
        .input-field {
            @apply w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none transition-all duration-200 text-sm;
        }
        .input-field:focus {
            @apply bg-white border-blue-500 ring-4 ring-blue-500/10;
        }
    </style>
</head>
<body>

    <div id="loginPage" class="fixed inset-0 bg-[#0f172a] flex items-center justify-center z-[100] p-6">
        <div class="card-premium p-10 w-full max-w-[400px] text-center">
            <div class="mb-8">
                <div class="w-16 h-16 bg-blue-600 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-xl shadow-blue-500/40">
                    <i class="fas fa-key text-white text-2xl"></i>
                </div>
                <h2 class="text-2xl font-extrabold text-slate-900 tracking-tight">KHO XE VINFAST</h2>
                <p class="text-slate-400 text-sm mt-1">H·ªá th·ªëng qu·∫£n l√Ω n·ªôi b·ªô</p>
            </div>
            <div class="space-y-4">
                <input type="text" id="userInput" placeholder="T√™n ƒëƒÉng nh·∫≠p" class="input-field">
                <input type="password" id="passInput" placeholder="M·∫≠t kh·∫©u" class="input-field">
                <button onclick="handleLogin()" id="loginBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-xl font-bold transition-all shadow-lg shadow-blue-500/20 active:scale-[0.98]">
                    ƒêƒÇNG NH·∫¨P NGAY
                </button>
            </div>
            <p id="loginMsg" class="text-red-500 text-xs mt-6 font-semibold hidden"></p>
        </div>
    </div>

    <div id="mainApp" class="hidden min-h-screen">
        <nav class="glass-header sticky top-0 z-50 px-8 py-4 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <img src="/assets/images/logo.jpg" class="h-6" alt="VinFast">
                <div class="h-6 w-[1px] bg-slate-200 mx-2"></div>
                <h1 class="font-heading text-lg font-extrabold tracking-tighter text-slate-800">INVENTORY</h1>
            </div>
            <div class="flex items-center gap-6">
                <div class="bg-slate-100 px-4 py-2 rounded-2xl flex items-center gap-3 border border-slate-200">
                    <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                    <span id="displayUser" class="text-xs font-bold text-slate-600"></span>
                </div>
                <button onclick="logout()" class="text-slate-400 hover:text-red-500 transition-colors">
                    <i class="fas fa-power-off"></i>
                </button>
            </div>
        </nav>

        <main class="max-w-[1600px] mx-auto p-8 space-y-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="card-premium p-6 flex items-center gap-5">
                    <div class="w-12 h-12 bg-blue-50 rounded-2xl flex items-center justify-center text-blue-600">
                        <i class="fas fa-car-side"></i>
                    </div>
                    <div>
                        <p class="text-xs font-bold text-slate-400 uppercase">T·ªïng t·ªìn kho</p>
                        <h4 id="statTotal" class="text-2xl font-black text-slate-800">--</h4>
                    </div>
                </div>
                <div class="card-premium p-6 flex items-center gap-5 border-l-4 border-l-blue-500">
                    <div>
                        <p class="text-xs font-bold text-slate-400 uppercase">Kho R·∫°ch Gi√°</p>
                        <h4 id="statRG" class="text-2xl font-black text-slate-800">--</h4>
                    </div>
                </div>
                <div class="card-premium p-6 flex items-center gap-5 border-l-4 border-l-purple-500">
                    <div>
                        <p class="text-xs font-bold text-slate-400 uppercase">Kho Ph√∫ Qu·ªëc</p>
                        <h4 id="statPQ" class="text-2xl font-black text-slate-800">--</h4>
                    </div>
                </div>
                <div class="card-premium p-6 flex items-center gap-5">
                    <div class="w-12 h-12 bg-rose-50 rounded-2xl flex items-center justify-center text-rose-600">
                        <i class="fas fa-exclamation-circle"></i>
                    </div>
                    <div>
                        <p class="text-xs font-bold text-slate-400 uppercase">L·ªách th·ª±c t·∫ø</p>
                        <h4 id="statMismatch" class="text-2xl font-black text-rose-600">--</h4>
                    </div>
                </div>
            </div>

            <div class="card-premium p-8 border-t-4 border-t-blue-600">
                <h3 class="font-heading text-sm font-extrabold text-slate-800 mb-6 flex items-center gap-2">
                    <i class="fas fa-plus-circle text-blue-600"></i> C·∫¨P NH·∫¨T TH√îNG TIN XE
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6">
                    <div class="space-y-2">
                        <label class="text-[11px] font-extrabold text-slate-500 ml-1">S·ªê KHUNG (VIN)</label>
                        <input id="f0" class="input-field font-mono font-bold text-blue-700" placeholder="Nh·∫≠p s·ªë khung...">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[11px] font-extrabold text-slate-500 ml-1">D√íNG XE</label>
                        <input id="f1" class="input-field" placeholder="VD: VF 8 Plus">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[11px] font-extrabold text-slate-500 ml-1">M√ÄU S·∫ÆC</label>
                        <input id="f2" class="input-field" placeholder="M√†u s∆°n xe">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[11px] font-extrabold text-slate-500 ml-1">V·ªä TR√ç KHO</label>
                        <select id="f5" class="input-field font-bold text-blue-600 cursor-pointer">
                            <option value="R·∫°ch Gi√°">üìç R·∫°ch Gi√°</option>
                            <option value="Ph√∫ Qu·ªëc">üìç Ph√∫ Qu·ªëc</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="text-[11px] font-extrabold text-slate-500 ml-1">TR·∫†NG TH√ÅI</label>
                        <select id="f6" class="input-field cursor-pointer">
                            <option value="C√≤n h√†ng">C√≤n h√†ng</option>
                            <option value="ƒê√£ c·ªçc">ƒê√£ c·ªçc</option>
                            <option value="ƒê√£ b√°n">ƒê√£ b√°n</option>
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button onclick="saveItem()" class="w-full bg-slate-900 hover:bg-black text-white py-3 rounded-xl font-bold transition-all active:scale-95 shadow-lg">L∆ØU XE</button>
                    </div>
                </div>
            </div>

            <div class="card-premium overflow-hidden border border-slate-200">
                <div class="overflow-x-auto max-h-[60vh]">
                    <table class="v-table w-full text-left border-collapse">
                        <thead>
                            <tr>
                                <th>S·ªë Khung (VIN)</th>
                                <th>Th√¥ng tin chi ti·∫øt</th>
                                <th>M√†u s·∫Øc</th>
                                <th class="text-center">V·ªã tr√≠</th>
                                <th class="text-center">ƒê·ªëi so√°t</th>
                                <th class="text-center">Tr·∫°ng th√°i</th>
                                <th class="text-right pr-8">#</th>
                            </tr>
                            <tr class="bg-slate-50/50">
                                <td class="p-3"><input type="text" onkeyup="filterData()" class="filter-input search-box" data-col="c0" placeholder="L·ªçc VIN..."></td>
                                <td class="p-3"><input type="text" onkeyup="filterData()" class="filter-input search-box" data-col="c1" placeholder="D√≤ng xe/NƒÉm..."></td>
                                <td class="p-3"><input type="text" onkeyup="filterData()" class="filter-input search-box" data-col="c2" placeholder="M√†u xe..."></td>
                                <td class="p-3">
                                    <select onchange="filterData()" class="filter-input search-box" data-col="c5">
                                        <option value="">T·∫•t c·∫£ kho</option>
                                        <option value="R·∫°ch Gi√°">R·∫°ch Gi√°</option>
                                        <option value="Ph√∫ Qu·ªëc">Ph√∫ Qu·ªëc</option>
                                    </select>
                                </td>
                                <td class="p-3">
                                    <select onchange="filterData()" class="filter-input search-box" data-col="match">
                                        <option value="">T·∫•t c·∫£</option>
                                        <option value="C√≥">Kh·ªõp</option>
                                        <option value="Kh√¥ng">Ch∆∞a kh·ªõp</option>
                                    </select>
                                </td>
                                <td class="p-3"><input type="text" onkeyup="filterData()" class="filter-input search-box" data-col="c6" placeholder="Tr·∫°ng th√°i..."></td>
                                <td></td>
                            </tr>
                        </thead>
                        <tbody id="tableBody" class="divide-y divide-slate-100 bg-white">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbxhex6ID8BzU2_Rwwxfs95OofEzN1lh1bEEAcsjiaf6RpZfmFkEqfKnW00vXYb4CEVI/exec";
        let allData = [];

        window.onload = () => { if(localStorage.getItem('vf_token')) showApp(); };

        async function handleLogin() {
            const user = document.getElementById('userInput').value;
            const pass = document.getElementById('passInput').value;
            const btn = document.getElementById('loginBtn');
            const msg = document.getElementById('loginMsg');
            
            if(!user || !pass) return;
            btn.innerText = "ƒêANG X·ª¨ L√ù...";
            btn.disabled = true;

            try {
                const response = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'login', user, pass }) });
                const res = await response.json();
                if(res.success) {
                    localStorage.setItem('vf_token', res.token);
                    localStorage.setItem('vf_user', user);
                    showApp();
                } else {
                    msg.innerText = "T√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ch√≠nh x√°c!";
                    msg.classList.remove('hidden');
                }
            } catch (e) { alert("L·ªói k·∫øt n·ªëi API!"); }
            finally { btn.innerText = "ƒêƒÇNG NH·∫¨P NGAY"; btn.disabled = false; }
        }

        function showApp() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('displayUser').innerText = localStorage.getItem('vf_user').toUpperCase();
            loadData();
        }

        function logout() { localStorage.clear(); location.reload(); }

        async function loadData() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '<tr><td colspan="7" class="p-20 text-center text-slate-400 font-medium">ƒêang ƒë·ªìng b·ªô d·ªØ li·ªáu...</td></tr>';
            try {
                const response = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'getVehicles' }) });
                allData = await response.json();
                updateStats(allData);
                renderTable(allData);
            } catch (e) { tbody.innerHTML = '<tr><td colspan="7" class="p-20 text-center text-red-500 font-bold">L·ªói t·∫£i d·ªØ li·ªáu. H√£y ki·ªÉm tra AppScript!</td></tr>'; }
        }

        function updateStats(data) {
            document.getElementById('statTotal').innerText = data.length;
            document.getElementById('statRG').innerText = data.filter(i => i.c5 === 'R·∫°ch Gi√°').length;
            document.getElementById('statPQ').innerText = data.filter(i => i.c5 === 'Ph√∫ Qu·ªëc').length;
            document.getElementById('statMismatch').innerText = data.filter(i => i.match === 'Kh√¥ng').length;
        }

        function renderTable(data) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            data.forEach(item => {
                const matchClass = item.match === 'C√≥' ? 'bg-green-50 text-green-700' : 'bg-red-50 text-red-700';
                const khoColor = item.c5 === 'R·∫°ch Gi√°' ? 'text-blue-600' : 'text-purple-600';
                const statusColor = item.c6 === 'C√≤n h√†ng' ? 'bg-slate-100 text-slate-600' : (item.c6 === 'ƒê√£ c·ªçc' ? 'bg-amber-50 text-amber-600' : 'bg-blue-600 text-white');

                tbody.innerHTML += `
                    <tr class="hover:bg-slate-50/80 transition-all group">
                        <td class="p-4 font-mono font-bold text-blue-700 text-xs tracking-wider">${item.c0}</td>
                        <td class="p-4">
                            <div class="font-bold text-slate-800">${item.c1}</div>
                            <div class="text-[10px] text-slate-400 font-bold">S·∫¢N XU·∫§T ${item.c3}</div>
                        </td>
                        <td class="p-4"><span class="font-bold text-slate-600 text-sm italic">${item.c2}</span></td>
                        <td class="p-4 text-center font-black ${khoColor} text-xs uppercase underline underline-offset-4 decoration-2 decoration-slate-100">${item.c5}</td>
                        <td class="p-4 text-center"><span class="badge ${matchClass}">${item.match === 'C√≥' ? '<i class="fas fa-check-circle"></i>' : '<i class="fas fa-times-circle"></i>'} ${item.match}</span></td>
                        <td class="p-4 text-center"><span class="badge ${statusColor}">${item.c6}</span></td>
                        <td class="p-4 text-right pr-6">
                            <div class="flex justify-end gap-2">
                                <button onclick="editItem('${item.c0}')" class="btn-action bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white"><i class="fas fa-edit"></i></button>
                                <button onclick="deleteItem('${item.c0}')" class="btn-action bg-red-50 text-red-400 hover:bg-red-600 hover:text-white"><i class="fas fa-trash-alt"></i></button>
                            </div>
                        </td>
                    </tr>
                `;
            });
        }

        function filterData() {
            const filters = Array.from(document.querySelectorAll('.search-box')).map(el => ({ col: el.dataset.col, val: el.value.toLowerCase().trim() }));
            const filtered = allData.filter(item => filters.every(f => !f.val || String(item[f.col]).toLowerCase().includes(f.val)));
            renderTable(filtered);
            updateStats(filtered);
        }

        async function saveItem() {
            const vin = document.getElementById('f0').value.trim();
            if(!vin) return;
            const data = [vin, document.getElementById('f1').value, document.getElementById('f2').value, "", "", document.getElementById('f5').value, document.getElementById('f6').value, ""];
            await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'save', data: data }) });
            location.reload();
        }

        async function deleteItem(vin) {
            if(!confirm("X√°c nh·∫≠n g·ª° xe "+vin+" kh·ªèi kho qu·∫£n l√Ω?")) return;
            await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'delete', vin: vin }) });
            loadData();
        }

        function editItem(vin) {
            const item = allData.find(i => i.c0 === vin);
            document.getElementById('f0').value = item.c0;
            document.getElementById('f1').value = item.c1;
            document.getElementById('f2').value = item.c2;
            document.getElementById('f5').value = item.c5;
            document.getElementById('f6').value = item.c6;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
